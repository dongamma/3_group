# 2장 정리

# 머신러닝 프로젝트 과정

![Untitled](2%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5%209955e4a849684c9e94003f0fc9e8ba0b/Untitled.png)

- 대부분의 작업은 다음과 같이 이루어짐
    1. 데이터 준비 단계
    2. 모니터링 도구 구축
    3. 사람의 평가 파이프라인 세팅
    4. 주기적인 모델 학습 자동화

## 1. 큰 그림 보기

### 문제 정의

- 목적이 정확히 뭔지
- 문제 구성, 알고리즘 선택, 모델 평가와 성능 지표, 모델 튜닝시에 리소스 결정
- 지도 & 비지도 & 강화? or 분류 & 회귀?

### 성능 측정 지표 선택

- 오차가 커질 수록 이 값은 더욱 커지므로 예측에 얼마나 많은 오류가 있는지 가늠
- 예측값의 벡터와 타깃값의 벡터 사이의 거리를 재는 방법

### 가정검사

## 2. 데이터 가져오기

1. 작업환경 구축
2. 데이터 다운로드
3. 데이터 구조 확인 - 메서드 활용 및 히스토그램과 같은 시각화 활용
4. 테스트 세트 생성
    1. 테스트 세트는 전체 데이터 셋의 20%
    2. 모델 학습 시작 이전에 하며 테스트 세트는 미리 분석하지 말것
    3. 테스트 세트를 구분하는 방식에 따라 결과가 조금 달라짐 (무작위 샘플링 vs 계층적 샘플링)
    4. 계층적 샘플링
        
        ⇒ 전체 계층을 대표하도록 각 계층별로 적절한 샘플 추출 (계층별로 충분한 크기의 샘플이 포함되어야 함)
        

## 3. 데이터 이해를 위한 탐색과 시각화

1. 훈련 세트에 대해서만 시각화를 사용해 탐색
2. 상관관계 조사
    1. 상관계수는 기울기와 아무 연관 없음
    
    ```python
    # 타겟 변수에 대한 상관계수 값을 내림차순으로 출력 
    corr_matrix["타겟변수명"].sort_value(ascending=False)
    ```
    

## 4. 머신러닝 알고리즘을 위한 데이터 준비

### 자동화 함수 생성

- 함수를 만들어 데이터 준비 작업을 자동화 시키면 여러가지 데이터 변환을 쉽게 시도할 수 있어 어떤 조합이 가장 좋은지 확인하는데 편리함

### 데이터 전처리

- 모델 학습을 효율적으로 진행하기 위해 주어진 데이터를 변환
- 데이터 정제 - 수치형 데이터 전처리 과정
    - 누락된 특성값 처리
    - 해당 구역 제거 & 전체 특성 삭제 & 특정 값으로 채우기
    - SimpleImputer로 누락된 값을 손쉽게 다룸
- 텍스트 특성 다루기
    - OrdinalEncoder 클래스 사용 - 텍스트를 수치화
- 원핫 인코딩
    - 수치화된 범주들 사이의 크기 비교를 피하기 위해 더미 특성을 추가하여 활용
    - 생성되는 더미 특성은 사용된 범주를 사용
    - 예를들어 원하는 해당 카테고리의 특성값은 1로 나머지 카테고리의 특성값은 0으로 지정
    - OneHotEncoder 클래스 제공
        
        ```python
        from sklearn.preprocessing import OneHotEncoder
        
        cat = OneHotEncoder()
        housing_cat_hot = cat.fit_transform(housing_cat)
        ```
        

### 나만의 변환기

- 수치형 데이터 전처리 과정으로 조합 특성을 추가
- 변환기 클래스를 선언하기 위해서는 fit() 메서드와 transform() 메서드만 정의함

![Untitled](2%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5%209955e4a849684c9e94003f0fc9e8ba0b/Untitled%201.png)

### 특성 스케일 - 수치 데이터 전처리 과정

- 머신러닝 알고리즘은 입력 데이터셋의 특성값들의 범위가 다르면 제대로 작동  X
- 특성에 따라 다루는 숫자의 크기가 다를 때 통일된 스케일링이 필요
- **min - max 스케일링**
    - 정규화라고도 불림
    - 0~1 범위에 들도록 값을 이동하고 스케일을 조정
    - 이상치에 매우 민감
    - MinMaxScaler 변환기 제공
- **표준화**
    - 평균을 뺀 후 표준편차로 나누어 결과 분포의 분산이 1이 되도록 함
    - 이상치에 영향을 덜받음
    - 변환된 데이터들이 표준정규분포를 이룸
    - StandardScaler 변환기 제공

### 변환 파이프라인

- 모든 전처리 단계를 정확한 순서대로 연속적으로 진행되어야 함
- Pipeline 클래스가 이 기능을 지원
- 수치형 데이터 전처리 과정을 파이프라인으로 묶은 방법

![Untitled](2%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5%209955e4a849684c9e94003f0fc9e8ba0b/Untitled%202.png)

## 5. 모델 선택과 훈련

- 훈련 세트에서 훈련하고 평가하기
    - 여러 모델을 훈련 데이터 셋을 이용해 학습 시키고 RMSE를 이용해 예측 오차를 확인한다
- 교차 검증을 사용한 평가
    - k-겹 교차 검증
        - 훈련 세트를 fold라 불리는 k-개의 부분 집합으로 무작위 분할
        - 총 k번 지정된 모델을 훈련
        - 최종적으로 k번의 평가 결과가 담긴 배열 생성

## 6. 모델 세부 튜닝

### 그리드 탐색

- 만족할 만한 하이퍼 파라미터 조합을 찾을 때까지 수동으로 하이퍼 파라미터 조정
- GridSearchCV 사용
- 적은 수의 조합을 탐색할 때 유용

### 랜덤 선택

- 조합의 수가 커지거나 설정된 탐색 공간이 커질경우 랜덤 선택이 효율적
- RandomizedSearchCV 사용

### 앙상블 방법

- 최상의 모델을 연결해 보는 방법

### 최상의 모델과 오차 분석

- 얻어진 최상의 모델을 분석해서 문제에 대한 좋은 통찰을 얻을 수 있음
- 이정보를 통해 덜 중요한 특성들을 제외함
    - 추가 특성 포함
    - 불필요한 특성 제거
    - 이상치 제외
- 테스트 세트로 시스템 평가
- 테스트 세트 전처리
    - 전처리 파이프라인의 transform() 메서드를 직접 활용
- 최상의 모델을 이용하여 예측하고 모델 평가 및 론칭

## 7. 론칭, 모니터링, 시스템 유지 보수

- 모델을 상용 환경에 배포
- 모니터링 코드를 작성
    - 성능 체크 및 성능 저하시 알람기능
- 데이터셋을 업데이트하고 모델을 정기적으로 다시 훈련